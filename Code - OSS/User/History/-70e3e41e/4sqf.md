# Курсовой проект по дисциплине "Базы Данных"

---

### Введение

<b><u>Цель работы</u>:</b> получение практических навыков работы с промышленными СУБД, проектирование
БД (концептуальное, логическое, физическое), создание хранимых процедур, представлений,
триггеров, индексов. Попрактиковаться в тестировании запросов (DQ — Data Quality).  
<b><u>Инструменты</u>:</b> PostgreSQL 15, Python 3.8+ (можно любой другой ваш любимый язык программирования), Gitlab CI.

---

### Организационные моменты

Если при выполнении задания возникают вопросы, не стесняйтесь их задавать.

Если вы начинаете присылать задание за час до дедлайна, будьте готовы к тому, что полный балл вы
за него не получите, т.к. не успеете исправить все замечания.

Семинарист тоже человек, иногда спит / ест / живет своей жизнью и т.д., поэтому фидбек по своему
заданию вы будете получать не через минуту после отправки, а в течение дня.

И нет, если семинарист прямо сейчас онлайн, это все еще не значит, что фидбек вы получите
сиюминутно. Учитывайте это, пожалуйста.

**Важно**: используйте человекочитаемые названия для **всех** ваших файлов.

**_Дедлайны согласовывайте с семинаристами_**

---

### Постановка

1. Выбрать предметную область, выделить в ней 4-6 сущностей, согласовать с семинаристом.
2. Спроектировать базу данных:
   1. <u>Концептуальная модель</u>: все сущности из п.1 с указанием связей в нотации «воронья лапка». 
   2. <u>Логическая модель</u>: описание таблиц и их атрибутивного состава, а также указание связей в нотации «воронья 
   лапка». БД должна находиться во 2НФ или в 3НФ (аргументировать свой выбор). После нормализации ~ 8-10 сущностей. 
   Для описания использовать ER-диаграмму. Хотя бы одну таблицу необходимо сделать версионной. На выбор представляются 
   SCD типа 2 и 4. Для именования полей и сущностей использовать multitran. В полях использовать стандартные суффикса из
   соответствующего файла. 
   3. <u>Физическая модель</u>: описание хранения таблиц в СУБД. Для каждой сущности из п.2.2 подготовить таблицу вида
   (при желании можно добавить столбцы `PRIMARY KEY`, `FOREIGN KEY` со ссылкой на внешнюю таблицу). Названия таблиц 
   быть должны в единичном числе, имена колонок в нижнем регистре. **Пример:**  
    

   **STUDENT**   

| Название       | Описание      | Тип данных     | Ограничение   |
|----------------| ------------- | -------------- |---------------|
| `student_id`   | Идентификатор | `INTEGER`      | `PRIMARY KEY` |
| `student_name` | Имя студента  | `VARCHAR(128)` | `NOT NULL`    |
| ...            | ...           | ...            | ...           |

 3. Подготовить DDL скрипты и создать свою базу в СУБД.
 4. Наполнить созданную базу данными, ~10 записей в каждой таблице. По крайней мере по 1
    строке в каждой таблице должно быть добавлено с использованием `INSERT`.
 5. Написать не менее 10 `INSERT`, `SELECT`, `UPDATE`, `DELETE` запросов. Загуглить, что
    такое CRUD-запросы. Найти соответствие.
 6. Написать не менее 6 осмысленных `SELECT`-запросов с использованием:
    1. `GROUP BY + HAVING`
    2. `ORDER BY`
    3. `<func>(...) OVER(...)`:
       1. `PARTITION BY`
       2. `ORDER BY`
       3. `PARTITION BY + ORDER BY`
       4. `<func>` - все 3 типа функций - агрегирующие, ранжирующие, смещения
 7. Написать тесты к запросам из предыдущего пункта + приложить описание самих запросов и тестов к ним.
 8. Создать индексы для таблиц, аргументировав выбор поля, по которому будет создан индекс.
 9. Подготовить не менее 6 представлений:
    1. 2-3 получаются сокрытием полей с персональными данными клиентов из таблицы, а
       также сокрытием технических полей. Для сокрытия полей с персональными данными
       недостаточно просто целиком удалить столбец с данными. Например, для поля
       `CARD_NO` можно использовать маскировку вида `4276********0000`.
       **Вместе с кодом должны быть тесты для представлений.**
    2. 3-4 получаются соединением нескольких таблиц с целью получения осмысленной
       сводной таблицы, например, хранящей некоторую статистику продаж/частот
       обращения клиента и т.д.
       **Вместе с кодом должны быть тесты для представлений.**
 10. Создать не менее 2 хранимых процедур/функций. Логика процедур/функций согласовывается с семинаристом. **Вместе с кодом должны быть тесты для хранимого кода.**
 11. Создать не менее 2 триггеров. Логика согласовывается с семинаристом.
 12. Используя любимый язык программирования и библиотеку, сгенерировать данные и с их помощью вставить данные в уже 
     оформленную БД. Теми же инструментами извлечь данные (из таблицы на выбор), возможно, предварительно 
     агрегированные средствами СУБД, и провести анализ (графики/heatmap - на ваше усмотрение).

---

### Оценивание

| Задание | Балл  | Примечание                                                     |
|---------| ----- |----------------------------------------------------------------|
| `1`     | `0`   | Является стартовой точкой вашего проекта                       |
| `2.1`   | `0.2` |                                                                | 
| `2.2`   | `0.2` |                                                                |
| `2.3`   | `0.3` |                                                                |
| `3`     | `0.2` |                                                                |
| `4`     | `0`   | Дублирует следующий пункт                                      |
| `5`     | `0.1` |                                                                |
| `6`     | `0.3` | По `0.05` за каждый осмысленный запрос                         |
| `7`     | `0`   | Без тестов не засчитываются запросы из пункта выше             |
| `8`     | `0.1` |                                                                |
| `9`     | `0.6` | По `0.1` за каждое представление, `0.05` - если нет тестов     |
| `10`    | `0.4` | `0.1` - если нет тестов                                        |
| `11`    | `0.4` |                                                                |
| `12`    | `0.6` | Придется самостоятельно править CI и устанавливать зависимости |

Максимальный балл за проект равен 3 баллам, даже если вы наберете больше.

---

### Проверяющая система

Для проекта нет заранее определенной тестирующей системы. В процессе создания проекта вы также и
реализуете проверяющую систему.

---

### Структура проекта
От вас ожидается примерная структура проекта в вашем личном репозитории под него:
```shell
.
├── .gitlab-ci.yml           <- описание пайплайна для проекта (по шагам)
├── README.md                <- описание вашего проекта (какая предметная область и тд)
├── analysis                 <- описание 
│   ├── __init__.py
│   ├── analysis.py
│   └── fill_tables.py
│   └── ...
├── docs                     <- картинки и таблички
│   ├── conceptual-model.png
│   ├── logical-model.png
│   └── physical-model.md
├── requirements.txt         <- зависимости для Python
├── scripts                  <- sql-скрипты (структура этой директории может быть другой на ваше усмотрение)
│   ├── inserts1.sql
│   ├── ...
│   ├── table1_ddl.sql
│   └── ...
├── tests                    <- директория с тестами (структура этой директории может быть другой на ваше усмотрение)
│   ├── __init__.py
│   ├── conftest.py
│   ├── test1.py
│   ├── test2.py
│   └── ...
└── ...                      <- любые другие необходимые файлы

```

---

### Пример

В [директории](./example) можете найти пример **очень упрощенного варианта** проекта, который далеко не идеален. 
Его можно использовать как "костяк" уже для вашего проекта. Учтите, что в первую очередь это пример интеграции и запуска
скриптов в Gitlab CI.

[Внутри](./example/tech-overview.md) проекта будут небольшие объяснения что и как работает.
